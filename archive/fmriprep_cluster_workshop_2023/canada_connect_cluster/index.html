
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../joint_meeting_notes/">
      
      
        <link rel="next" href="../../rookie_experience_2019/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Compute Canada - CPP lab HPC guide</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-fmriprep-or-mriqc-on-a-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CPP lab HPC guide" class="md-header__button md-logo" aria-label="CPP lab HPC guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CPP lab HPC guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compute Canada
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/cpp-lln-lab/CPP_HPC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cpp-lln-lab/CPP_HPC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CPP lab HPC guide" class="md-nav__button md-logo" aria-label="CPP lab HPC guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CPP lab HPC guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cpp-lln-lab/CPP_HPC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cpp-lln-lab/CPP_HPC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome and FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    HPC UCLouvain (CECI)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HPC UCLouvain (CECI)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cluster_code_snippets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster code snippets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../install_datalad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    install datalad on the cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../run_fmriprep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    run fmriprep
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../run_mriqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    run mriqc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    fmriprep cluster workshop (2023)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            fmriprep cluster workshop (2023)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../joint_meeting_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meeting notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Compute Canada
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Compute Canada
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connect-to-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Connect to the cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connect to the cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-your-ssh-key" class="md-nav__link">
    <span class="md-ellipsis">
      Add your ssh key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-files" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-scp-to-copy-individual-files-and-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Use scp to copy individual files and directories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-rsync-to-sync-files-or-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Use rsync to sync files or directories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-datalad" class="md-nav__link">
    <span class="md-ellipsis">
      Use datalad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Running jobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-job-script" class="md-nav__link">
    <span class="md-ellipsis">
      Create job script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-job" class="md-nav__link">
    <span class="md-ellipsis">
      Submit job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-job-status" class="md-nav__link">
    <span class="md-ellipsis">
      Check job status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cancel-job" class="md-nav__link">
    <span class="md-ellipsis">
      Cancel job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-does-the-output-go" class="md-nav__link">
    <span class="md-ellipsis">
      Where does the output go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tip" class="md-nav__link">
    <span class="md-ellipsis">
      Tip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-singularity-on-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Running singularity on a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running singularity on a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-fmriprep-on-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Run fmriprep on cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rookie_experience_2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rookie experience (2019)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running_fmriprep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fmriprep notes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connect-to-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Connect to the cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connect to the cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-your-ssh-key" class="md-nav__link">
    <span class="md-ellipsis">
      Add your ssh key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-files" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-scp-to-copy-individual-files-and-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Use scp to copy individual files and directories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-rsync-to-sync-files-or-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Use rsync to sync files or directories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-datalad" class="md-nav__link">
    <span class="md-ellipsis">
      Use datalad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Running jobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-job-script" class="md-nav__link">
    <span class="md-ellipsis">
      Create job script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-job" class="md-nav__link">
    <span class="md-ellipsis">
      Submit job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-job-status" class="md-nav__link">
    <span class="md-ellipsis">
      Check job status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cancel-job" class="md-nav__link">
    <span class="md-ellipsis">
      Cancel job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-does-the-output-go" class="md-nav__link">
    <span class="md-ellipsis">
      Where does the output go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tip" class="md-nav__link">
    <span class="md-ellipsis">
      Tip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-singularity-on-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Running singularity on a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running singularity on a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-fmriprep-on-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Run fmriprep on cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="running-fmriprep-or-mriqc-on-a-cluster"><a class="toclink" href="#running-fmriprep-or-mriqc-on-a-cluster">Running fmriprep or mriqc on a cluster</a><a class="headerlink" href="#running-fmriprep-or-mriqc-on-a-cluster" title="Permanent link">#</a></h1>
<h2 id="connect-to-the-cluster"><a class="toclink" href="#connect-to-the-cluster">Connect to the cluster</a><a class="headerlink" href="#connect-to-the-cluster" title="Permanent link">#</a></h2>
<p>Open your terminal and type:</p>
<pre><code class="language-bash">ssh &lt;username&gt;@graham.computecanada.ca # Graham login node
</code></pre>
<h3 id="add-your-ssh-key"><a class="toclink" href="#add-your-ssh-key">Add your ssh key</a><a class="headerlink" href="#add-your-ssh-key" title="Permanent link">#</a></h3>
<p>SSH key pairs are very useful to avoid typing passwords</p>
<h2 id="modules"><a class="toclink" href="#modules">Modules</a><a class="headerlink" href="#modules" title="Permanent link">#</a></h2>
<p>There are pre-installed modules that youâ€™ll need to load in order to use. To see
all modules available: <code>module avail</code></p>
<p>To load module (you can put this in your .bashrc if you need the module all the
time): <code>module load &lt;module_name&gt;</code></p>
<p>Example: Check if git is available and load it</p>
<pre><code class="language-bash">module avail git
module load apps/git/2.13.0
</code></pre>
<h2 id="transfer-files"><a class="toclink" href="#transfer-files">Transfer files</a><a class="headerlink" href="#transfer-files" title="Permanent link">#</a></h2>
<h3 id="use-scp-to-copy-individual-files-and-directories"><a class="toclink" href="#use-scp-to-copy-individual-files-and-directories">Use scp to copy individual files and directories</a><a class="headerlink" href="#use-scp-to-copy-individual-files-and-directories" title="Permanent link">#</a></h3>
<pre><code class="language-bash">scp &lt;filename&gt; &lt;username&gt;@graham.computecanada.ca:&lt;PATH/TO/FILE&gt;
scp &lt;username&gt;@graham.computecanada.ca:&lt;PATH/TO/FILE&gt; &lt;LocalPath&gt;
</code></pre>
<h3 id="use-rsync-to-sync-files-or-directories"><a class="toclink" href="#use-rsync-to-sync-files-or-directories">Use rsync to sync files or directories</a><a class="headerlink" href="#use-rsync-to-sync-files-or-directories" title="Permanent link">#</a></h3>
<pre><code class="language-bash">rsync &lt;LocalPath/filename&gt; &lt;username&gt;@graham.computecanada.ca:&lt;PATH/TO/FILE&gt;
rsync &lt;username&gt;@graham.computecanada.ca:&lt;PATH/TO/FILE&gt; &lt;LocalPath&gt;
</code></pre>
<h3 id="use-datalad"><a class="toclink" href="#use-datalad">Use datalad</a><a class="headerlink" href="#use-datalad" title="Permanent link">#</a></h3>
<p>Install Datalad on your cluster :</p>
<pre><code class="language-bash">module load git-annex python/3
virtualenv ~/venv_datalad
source ~/venv_datalad/bin/activate
pip install datalad
</code></pre>
<p>See
<a href="https://cbs-discourse.uwo.ca/t/installing-datalad-on-compute-canada/23?fbclid=IwAR0cCi1HeA5uU0eHGmR9tdwlbtElpDAcdONRK5cPtPVo5g8RKAg_Iv37Kxo">here for more details</a>.</p>
<h2 id="running-jobs"><a class="toclink" href="#running-jobs">Running jobs</a><a class="headerlink" href="#running-jobs" title="Permanent link">#</a></h2>
<h3 id="create-job-script"><a class="toclink" href="#create-job-script">Create job script</a><a class="headerlink" href="#create-job-script" title="Permanent link">#</a></h3>
<p>Here is an example of a simple bash script:</p>
<pre><code class="language-bash">#!/bin/bash
#SBATCH --time=00:05:00
#SBATCH --account=def-flepore
echo 'Hello, world!'
sleep 20
</code></pre>
<h3 id="submit-job"><a class="toclink" href="#submit-job">Submit job</a><a class="headerlink" href="#submit-job" title="Permanent link">#</a></h3>
<p>In the cluster terminal</p>
<pre><code class="language-bash">sbatch &lt;name of the file&gt;
</code></pre>
<p>Example:</p>
<pre><code class="language-bash">sbatch simple.sh
Submitted batch job 65869853
</code></pre>
<h3 id="check-job-status"><a class="toclink" href="#check-job-status">Check job status</a><a class="headerlink" href="#check-job-status" title="Permanent link">#</a></h3>
<p>Use squeue or sq to list jobs</p>
<pre><code class="language-bash">sq

JOBID     USER              ACCOUNT           NAME  ST  TIME_LEFT NODES CPUS TRES_PER_N MIN_MEM NODELIST (REASON)
65869853 mmaclean      def-flepore_cpu      simple.sh  PD       5:00     1    1        N/A    256M  (Priority)
</code></pre>
<p>Use email notification to learn when your job starts and ends by adding the
following at the top of your script:</p>
<pre><code class="language-bash">#SBATCH --mail-user=michele.maclean@umontreal.ca
#SBATCH --mail-type=BEGIN
#SBATCH --mail-type=END
#SBATCH --mail-type=FAIL
#SBATCH --mail-type=REQUEUE
#SBATCH --mail-type=ALL
</code></pre>
<h3 id="cancel-job"><a class="toclink" href="#cancel-job">Cancel job</a><a class="headerlink" href="#cancel-job" title="Permanent link">#</a></h3>
<pre><code class="language-bash">scancel &lt;jobid&gt;
scancel 65869853
</code></pre>
<h3 id="where-does-the-output-go"><a class="toclink" href="#where-does-the-output-go">Where does the output go</a><a class="headerlink" href="#where-does-the-output-go" title="Permanent link">#</a></h3>
<p>By default the output is placed in a file named "slurm-", suffixed with the job
ID number and ".out", e.g. slurm-65869853.out, in the directory from which the
job was submitted. Having the job ID as part of the file name is convenient for
troubleshooting Files will be output according to where you specified in your
bash script</p>
<h2 id="tip"><a class="toclink" href="#tip">Tip</a><a class="headerlink" href="#tip" title="Permanent link">#</a></h2>
<ol>
<li>Use <code>$SCRATCH</code> disk to run your scripts, because <code>$SCRATCH</code> is much faster
   than $HOME`.</li>
<li>Keep a working directory, if things crash you don't have to start from the
   beginning</li>
<li>check usage/space left on cluster: <code>diskusage_report</code></li>
<li>See if you need to delete files from scratch once jobs are complete- fmriprep
   output is quite heavy</li>
</ol>
<h2 id="running-singularity-on-a-cluster"><a class="toclink" href="#running-singularity-on-a-cluster">Running singularity on a cluster</a><a class="headerlink" href="#running-singularity-on-a-cluster" title="Permanent link">#</a></h2>
<p>Download the containers for fmriprep and mriqc here:</p>
<p>Repro nim containers: https://github.com/ReproNim/containers</p>
<ol>
<li>create directory</li>
</ol>
<pre><code class="language-bash">mkdir parallel_analysis
</code></pre>
<ol>
<li>install containers from repronim</li>
</ol>
<pre><code class="language-bash">cd parallel_analysis
datalad install https://github.com/ReproNim/containers.git
</code></pre>
<ol>
<li>retrieve the container you want, e.g., fmriprep</li>
</ol>
<pre><code class="language-bash">datalad get containers/images/bids/bids-fmriprep--21.0.1.sing
</code></pre>
<p>you might need to unlock the container to be able to use it</p>
<pre><code class="language-bash">datalad unlock containers/images/bids/bids-fmriprep--21.0.1.sing
</code></pre>
<h3 id="run-fmriprep-on-cluster"><a class="toclink" href="#run-fmriprep-on-cluster">Run fmriprep on cluster</a><a class="headerlink" href="#run-fmriprep-on-cluster" title="Permanent link">#</a></h3>
<p>Have your freesurfer license ready.</p>
<p>Here is an example script</p>
<pre><code class="language-bash">#!/bin/bash

# fail whenever something is fishy
# -e exit immediately
# -x to get verbose logfiles
# -u to fail when using undefined variables
# https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html
set -e -x -u -o pipefail

#-------------------------------------------
#SBATCH -J fmriprep
#SBATCH --account=def-flepore
#SBATCH --time=15:00:00
#SBATCH -n 1
#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=8G
#SBATCH --mail-user=michele.maclean@umontreal.ca
#SBATCH --mail-type=BEGIN
#SBATCH --mail-type=END
#SBATCH --mail-type=FAIL
#SBATCH --mail-type=REQUEUE
#SBATCH --mail-type=ALL
# ------------------------------------------

source ~/venv_datalad/bin/activate

module load git-annex/8.20200810
module load freesurfer/5.3.0
module load singularity/3.8

cd $HOME || exit

singularity run \
    --cleanenv \
    -B $HOME/scratch:/scratch \
    -B $HOME/projects/def-flepore/mmaclean:/mmaclean \
        $HOME/projects/def-flepore/mmaclean/parallel_analysis/containers/images/bids/bids-fmriprep--21.0.1.sing \
            /mmaclean/raw \
            /mmaclean/fmriprep-output \
            participant \
            --participant-label CTL01 \
            --work-dir /scratch/work-fmriprep \
            --fs-license-file /mmaclean/license/freesurfer.txt \
            --output-spaces MNI152NLin2009cAsym T1w \
            --skip_bids_validation \
            --notrack \
            --stop-on-first-crash

</code></pre>
<p>Extra reference:</p>
<ul>
<li><a href="https://andysbrainbook.readthedocs.io/en/latest/OpenScience/OS/fMRIPrep_Demo_2_RunningAnalysis.html?fbclid=IwAR01abjWmu5c3I19maqWTYUeu8rhR7S1RqJ7VZKliWUfEYOc6kK9ijwkXLk#running-singularity-on-a-supercomputing-cluster">andysbrainbook</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      MIT
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>